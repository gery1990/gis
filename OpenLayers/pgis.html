<html>

<head>
    <title>PGIS</title>
    <style type="text/css">
    #map {
        border: 1px solid #ccc;
    }
    </style>  
    <script src="lib/OpenLayers.js"></script>
    <script src="lib/Config.js"></script>
    <script src="lib/OpenLayers/Layer/TMS_PGIS.js"></script>  
    <style type="text/css">
    .olImageLoadError {
        background-color: transparent !important;
        display:none;
    }
    </style>
    <script src="jquery.min.js"></script>
    <script type="text/javascript">
    var map, wmsLayer, startTime;

    function init() {
        var imageUrl = "http://10.173.2.20/PGIS_S_TileMapServer/Maps/V"
        //maxZoomLevel:20,numZoomLevels:9,
        var bound = new OpenLayers.Bounds(12912392.532672398, 4819583.94446522, 13007098.010717731, 4877828.960018523);

        map = new OpenLayers.Map("map", {
            maxResolution: "auto",

            maxExtent: new OpenLayers.Bounds(107.4414, 33.75, 110.0039, 34.73046)
        }); //,maxResolution:1.40625
        map.events.register("zoomend", this, setZoomEnd);

        wmsLayer = new OpenLayers.Layer.TMS_PGIS("Name",
            imageUrl, {
                type: 'png',
                layername: 'pgis',
                 maxZoomLevel:20, 
                 numZoomLevels:21,
                isBaseLayer: true
             //  , tileOrigin: new OpenLayers.LonLat(107.4414, 33.75)
            });
        var pointLayer = new OpenLayers.Layer.Vector("Point Layer");
        var lineLayer = new OpenLayers.Layer.Vector("Line Layer");
        var polygonLayer = new OpenLayers.Layer.Vector("Polygon Layer");
        var boxLayer = new OpenLayers.Layer.Vector("Box layer");
        // map.addLayer(layer);
        map.addLayers([wmsLayer, pointLayer, lineLayer, polygonLayer, boxLayer]);
        // map.addControl(new OpenLayers.Control.PanZoomBar());
        map.addControl(new OpenLayers.Control.ScaleLine());
        map.addControl(new OpenLayers.Control.LayerSwitcher());
        map.addControl(new OpenLayers.Control.MousePosition());
        $(".olControlZoomIn.olButton").click(setZoomStart);
        $(".olControlZoomOut.olButton").click(setZoomStart);
        map.zoomTo(12);

        drawControls = {
            point: new OpenLayers.Control.DrawFeature(pointLayer,
                OpenLayers.Handler.Point),
            line: new OpenLayers.Control.DrawFeature(lineLayer,
                OpenLayers.Handler.Path),
            polygon: new OpenLayers.Control.DrawFeature(polygonLayer,
                OpenLayers.Handler.Polygon),
            box: new OpenLayers.Control.DrawFeature(boxLayer,
                OpenLayers.Handler.RegularPolygon, {
                    handlerOptions: {
                        sides: 4,
                        irregular: true
                    }
                }
            )
        };
        for (var key in drawControls) {
            map.addControl(drawControls[key]);
        }
        document.getElementById('noneToggle').checked = true;
    }

    function toggleControl(element) {
        for (key in drawControls) {
            var control = drawControls[key];
            if (element.value == key && element.checked) {
                control.activate();
            } else {
                control.deactivate();
            }
        }
    }

    function allowPan(element) {
        var stop = !element.checked;
        for (var key in drawControls) {
            drawControls[key].handler.stopDown = stop;
            drawControls[key].handler.stopUp = stop;
        }
    }
    //计时功能

    function calcTime(zoom) {
        setZoomStart();
        map.zoomTo(zoom);
    }

    function setZoomStart() {
        startTime = new Date();
    }

    function setZoomEnd() {
        document.getElementById("calctime").innerHTML = new Date() - startTime;
    }
    </script>
</head>
<!-- body.onload is called once the page is loaded (call the 'init' function) -->

<body onload="init();">
    <!-- define a DIV into which the map will appear. Make it take up the whole window -->
    <input type="button" value="12-20" data="20 " onclick="calcTime(20)" />
    <input type="button" value="20-12" data="12" onclick="calcTime(12)" />
    <span id="calctime"></span>
    <div style="width: 100%; height: 70%" id="map"></div>
    <ul id="controlToggle">
        <li>
            <input type="radio" name="type" value="none" id="noneToggle" onclick="toggleControl(this);" checked="checked" />
            <label for="noneToggle">navigate</label>
        </li>
        <li>
            <input type="radio" name="type" value="point" id="pointToggle" onclick="toggleControl(this);" />
            <label for="pointToggle">draw point</label>
        </li>
        <li>
            <input type="radio" name="type" value="line" id="lineToggle" onclick="toggleControl(this);" />
            <label for="lineToggle">draw line</label>
        </li>
        <li>
            <input type="radio" name="type" value="polygon" id="polygonToggle" onclick="toggleControl(this);" />
            <label for="polygonToggle">draw polygon</label>
        </li>
        <li>
            <input type="radio" name="type" value="box" id="boxToggle" onclick="toggleControl(this);" />
            <label for="boxToggle">draw box</label>
        </li>
        <li>
            <input type="checkbox" name="allow-pan" value="allow-pan" id="allowPanCheckbox" checked=true onclick="allowPan(this);" />
            <label for="allowPanCheckbox">allow pan while drawing</label>
        </li>
    </ul>
</body>

</html>
